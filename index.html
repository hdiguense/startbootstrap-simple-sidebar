<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Costa Rica Coffee Mills</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">

  <style>
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
  <!-- JQUERY -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>

<body>

  <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <!-- <div class="sidebar-heading">Filters </div> -->
      <div class="list-group list-group-flush">
        <form id="form_regions" class="list-group-item  bg-light">
          <p>Coffee Regions</p>
          <div class="form-check">
            <input type="checkbox" class="form-check-input esri-widget" id="allregions" value="'Regional Coto Brus', 'Regional Turrialba', 'Regional Pérez Zeledón', 'Regional Zona Norte'" checked>
            <label class="form-check-label" for="allregions">All regions</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="vallecentral"
              value="'Regional Valle Central'" checked>
            <label class="form-check-label" for="vallecentral">Valle Central</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="valleoccidental"
              value="'Regional Valle Occidental'" checked>
            <label class="form-check-label" for="valleoccidental">Valle Occidental</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="lossantons"
              value="'Regional Los Santos'" checked>
            <label class="form-check-label" for="lossantons">Los Santos</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="cotobrus"
              value="'Regional Coto Brus'" checked>
            <label class="form-check-label" for="cotobrus">Coto Brus</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="turrialba"
              value="'Regional Turrialba'" checked>
            <label class="form-check-label" for="turrialba">Turrialba</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="perezzeledon"
              value="'Regional Pérez Zeledón'" checked>
            <label class="form-check-label" for="perezzeledon">Pérez Zeledón</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class=" esri-widget" name="regions" class="form-check-input" id="zonanorte"
              value="'Regional Zona Norte'" checked>
            <label class="form-check-label" for="zonanorte">Zona Norte</label>
          </div>
          <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
        </form>
        <form id="form_process" class="list-group-item  bg-light">
          <p>Coffee processes</p>
          <div class="form-check">
            <input type="checkbox" name="process" class="form-check-input" id="allprocesses" checked>
            <label class="form-check-label" for="allprocesses">All processes</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="process" class="form-check-input" id="lavado" value=""
              checked>
            <label class="form-check-label" for="lavado">Lavado</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="process" class="form-check-input" id="honey"
              checked>
            <label class="form-check-label" for="honey">Honey</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="process" class="form-check-input" id="anaerobic"
              checked>
            <label class="form-check-label" for="anaerobic">Anaerobic</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="process" class="form-check-input" id="natual"
              checked>
            <label class="form-check-label" for="natural">Natural</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="process" class="form-check-input" id="other"
              checked>
            <label class="form-check-label" for="other">Other</label>
          </div>
          <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
        </form>
        <form id="form_mill" class="list-group-item  bg-light">
          <p>Mill size (fanegas)</p>
          <div class="form-check">
            <input type="checkbox" name="millsize" class="form-check-input" id="allsizes" checked>
            <label class="form-check-label" for="allsizes">All sizes</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="millsize" class="form-check-input" id="size1" checked>
            <label class="form-check-label" for="size1">0 - 1000</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="millsize" class="form-check-input" id="size2" checked>
            <label class="form-check-label" for="size2">1000 - 6000</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="millsize" class="form-check-input" id="lossantons"
              checked>
            <label class="form-check-label" for="lossantons">6000 - 30000</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="millsize" class="form-check-input" id="cotobrus"
              checked>
            <label class="form-check-label" for="cotobrus">30000 - 70000</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="esri-widget" name="millsize" class="form-check-input" id="turrialba"
              checked>
            <label class="form-check-label" for="turrialba">70000 - More</label>
          </div>
          <!-- <button type="submit" onclick="get_region(); return false" class="btn btn-primary">Submit</button> -->
        </form>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom" style="height: 6%;">
        <button class="btn btn-primary" id="menu-toggle">Menu</button>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Dropdown
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
          </ul>
        </div>
      </nav> -->

      <div class="container-fluid" style="height: 100%;">
        <div id="toggle">
          <button class="btn btn-primary" id="menu-toggle">Filters</button>
          <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button> -->
        </div>
        <div id="viewDiv">
        </div>
      </div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function (e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>

</body>
<script>
  //select all for all regions
  $("#allregions").click(function () {
    $("input[name=regions]").prop("checked", $(this).prop("checked"));
  });

  $("input[name=regions]").click(function () {
    if (!$(this).prop("checked")) {
      $("#allregions").prop("checked", false);
    }
  });

  //select all for all processes
  $("#allprocesses").click(function () {
    $("input[name=process]").prop("checked", $(this).prop("checked"));
  });

  $("input[name=process]").click(function () {
    if (!$(this).prop("checked")) {
      $("#allprocesses").prop("checked", false);
    }
  });

  //select all for all processes
  $("#allsizes").click(function () {
    $("input[name=millsize]").prop("checked", $(this).prop("checked"));
  });

  $("input[name=millsize]").click(function () {
    if (!$(this).prop("checked")) {
      $("#allsizes").prop("checked", false);
    }
  });
</script>
<!-- ArcGIS JS-->
<link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.15/"></script>

<script>
  require([
    "esri/Map",
    "esri/views/MapView",
    "esri/layers/FeatureLayer"
  ], function (Map, MapView, FeatureLayer) {

    var map = new Map({
      basemap: "dark-gray"
    });

    var view = new MapView({
      container: "viewDiv",
      map: map,
      center: [-84, 10],
      zoom: 8,
      ui: {
        components: []
      }
    });

    var featureLayer = new FeatureLayer({
      url: "https://sig.icafe.cr/server/rest/services/Hosted/Beneficios_promcion_features/FeatureServer/",
      outFields: ["*"], // Return all fields so it can be queried client-side
      //  popupTemplate: {  // Enable a popup
      //    title: "{TRL_NAME}", // Show attribute value
      //    content: "The trail elevation gain is {ELEV_GAIN} ft."  // Display in pop-up
      //  }
    });
    //regions
    var regions = document.getElementsByName('regions');
    var regions_sql = 'NOMBRE_REGIONAL IN (';

    //processes
    var processes = document.getElementsByName('process');
    var processes_sql = ''

    function get_region() {

      //regions
      regions_sql = 'NOMBRE_REGIONAL IN (';
      for (i = 0; i < regions.length; i++) {

        if (regions[i].checked === true) {
          regions_sql += regions[i].value + ', ';
        }
      };

      //Processes
      processes_sql = ''
      for(i = 0; i < processes.length; i++){
        if(processes[i].checked === true){
          processes_sql += processes[i].value + ',';
        };
        console.log(processes_sql);
      }

      //update view
      var expression = regions_sql.substring(0, regions_sql.length - 2) + ')';
      view.whenLayerView(featureLayer).then(function (featureLayerView) {
        featureLayerView.filter = {
          where: expression
        };
      });
      //console.log(expression)
    };

    //regions event listener
    for (i = 0; i < regions.length; ++i) {
      regions[i].addEventListener('change', get_region);
      console.log(regions[i])
    };

    //processes event listener
    for (i = 0; i < processes.length; ++i) {
      processes[i].addEventListener('change', get_region);
      console.log(processes[i])
    };

    map.add(featureLayer);

    view.ui.add("toggle", "top-left");

  });
</script>

</html>
